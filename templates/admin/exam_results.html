{% extends "admin/base.html" %}
{% block title %}Exam Results{% endblock %}

{% block content %}
<div class="container">
  <h2 class="mb-4">Exam Results</h2>

  <!-- Flash messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- Upload Form -->
  <form action="{{ url_for('admin_routes.exam_results') }}" method="POST"
        enctype="multipart/form-data" class="mb-5">
    <div class="row g-2 align-items-center">
      <div class="col-md-2">
        <input type="file" name="file" required class="form-control">
      </div>
      <div class="col-md-2">
        <input type="date" name="exam_date" required class="form-control">
      </div>
      <div class="col-md-2">
        <input type="text" name="exam_type" placeholder="Exam Type" required
               class="form-control">
      </div>
      <div class="col-md-2">
        <input type="text" name="exam_class" placeholder="Class" required
               class="form-control">
      </div>
      <div class="col-md-2">
        <input type="text" name="username" placeholder="Admin Username" required
               class="form-control">
      </div>
      <div class="col-md-2">
        <input type="password" name="password" placeholder="Admin Password" required
               class="form-control">
      </div>
    </div>
    <button type="submit" class="btn btn-success mt-2">Add Result</button>
  </form>

  <!-- Results Table -->
  <div class="table-responsive">
    <table class="table table-sm table-bordered">
      <thead class="table-dark">
        <tr>
          <th>File</th>
          <th>Exam Date</th>
          <th>Exam Type</th>
          <th>Class</th>
          <th>Uploaded At</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for r in results %}
        <tr>
          <td>
            <a href="{{ url_for('static',
                filename='../../uploads/exam_results/' ~ r.filename) }}"
               target="_blank">{{ r.filename }}</a>
          </td>
          <td>{{ r.exam_date }}</td>
          <td>{{ r.exam_type }}</td>
          <td>{{ r.exam_class }}</td>
          <td>{{ r.uploaded_at }}</td>
          <td>
            <form method="POST"
                  action="{{ url_for('admin_routes.delete_exam_result', filename=r.filename) }}">
              <input type="hidden" name="username" value="admin">
              <input type="password" name="password" placeholder="Password" required
                     class="form-control form-control-sm w-auto d-inline">
              <button type="submit" class="btn btn-sm btn-danger mt-1">Delete</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="6" class="text-center text-muted">No exam results found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
