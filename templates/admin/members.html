{% extends "admin/base.html" %}
{% block title %}Members & Verification{% endblock %}

{% block content %}
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Members</h2>
    <a href="{{ url_for('admin_routes.add_member') }}" class="btn btn-primary">Add Member</a>
  </div>

  <!-- Account Type Selector -->
  <form method="get" class="mb-4">
    <label for="acc_type" class="form-label">Select Account Type:</label>
    <select id="acc_type" name="type" class="form-select w-auto d-inline" onchange="this.form.submit()">
      {% for t in types %}
        <option value="{{ t }}" {% if t == selected_type %}selected{% endif %}>{{ t|replace('_',' ')|title }}</option>
      {% endfor %}
    </select>
  </form>

  <!-- Members Table for Selected Type -->
  {% if members %}
    <div class="table-responsive mb-5">
      <table class="table table-sm table-bordered">
        <thead class="table-dark">
          <tr>
            {% for col in members[0].keys() %}
              <th>{{ col.replace('_', ' ')|title }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for m in members %}
            <tr>
              {% for val in m.values() %}
                <td>{{ val }}</td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-muted">No members for "{{ selected_type }}"</p>
  {% endif %}

  <h2 class="mb-4">Pending Verifications</h2>
  {% if pending %}
    <div class="table-responsive">
      <table class="table table-sm table-bordered">
        <thead class="table-dark">
          <tr>
            {% for col in pending[0].keys() %}
              <th>{{ col.replace('_',' ')|title }}</th>
            {% endfor %}
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for p in pending %}
            <tr>
              {% for val in p.values() %}
                <td>{{ val }}</td>
              {% endfor %}
              <td>
                <form method="post" action="{{ url_for('admin_routes.verify_member', verify_people_id=p.user_id) }}">
                  <button type="submit" class="btn btn-sm btn-success">Verify</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-muted">No pending verifications</p>
  {% endif %}
</div>
{% endblock %}
