{% extends "admin/base.html" %}
{% block title %}Notices{% endblock %}

{% block content %}
<div class="container">
  <h2 class="mb-4">Manage Notices</h2>

  <!-- Flash messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- Upload Form -->
  <form action="{{ url_for('admin_routes.notice_page') }}" method="POST" enctype="multipart/form-data" class="mb-5">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <div class="row g-2 align-items-center">
      <div class="col-md-3">
        <input type="file" name="file" required class="form-control">
      </div>
      <div class="col-md-2">
        <input type="date" name="target_date" required class="form-control">
      </div>
      <div class="col-md-2">
        <input type="text" name="username" placeholder="Admin Username" required class="form-control">
      </div>
      <div class="col-md-2">
        <input type="password" name="password" placeholder="Admin Password" required class="form-control">
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-success">Add Notice</button>
      </div>
    </div>
  </form>

  <!-- Grouped Notices -->
  <div class="row">
    {% for title, group in [('Upcoming', upcoming), ('Ongoing', ongoing), ('Past', past)] %}
    <div class="col-md-4">
      <h5 class="text-center">{{ title }}</h5>
      <ul class="list-group">
        {% for n in group %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <a href="{{ url_for('static', filename='../../uploads/notices/' ~ n.filename) }}" target="_blank">{{ n.filename }}</a><br>
              <small>Target: {{ n.target_date }}</small><br>
              <small>Uploaded: {{ n.uploaded_at }}</small>
            </div>
            <form method="POST" action="{{ url_for('admin_routes.delete_notice', filename=n.filename) }}">
              <input type="hidden" name="username" value="admin">
              <input type="password" name="password" placeholder="Password" required class="form-control form-control-sm w-auto d-inline">
              <button type="submit" class="btn btn-sm btn-danger mt-1">Delete</button>
            </form>
          </li>
        {% else %}
          <li class="list-group-item text-muted text-center">No notices</li>
        {% endfor %}
      </ul>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
