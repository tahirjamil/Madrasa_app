{% extends "admin/base.html" %}
{% block title %}Request & Response Log{% endblock %}

{% block extra_css %}
<link href="/static/css/admin.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container py-4">
  <h1 class="mb-4">ðŸ“Š Request & Response Log</h1>

  <!-- Filters -->
  <div class="row g-2 mb-3">
    <div class="col-md-4">
      <input id="filter-text" type="text"
             class="form-control"
             placeholder="Filter by any textâ€¦">
    </div>
    <div class="col-md-3">
      <input id="filter-from" type="date"
             class="form-control"
             placeholder="From date">
    </div>
    <div class="col-md-3">
      <input id="filter-to" type="date"
             class="form-control"
             placeholder="To date">
    </div>
    <div class="col-md-2">
      <button id="clear-filters"
              class="btn btn-secondary w-100">
        Clear Filters
      </button>
    </div>
  </div>

  <div class="d-flex align-items-center mb-2">
    <p class="text-muted mb-0 me-3">
    Showing last <span id="entry-count">{{ logs|length }}</span> entries.
  </p>
    <button id="pause-refresh" class="btn btn-outline-primary btn-sm ms-auto">Pause Auto-Refresh</button>
  </div>

  <div class="table-responsive" style="max-height:70vh; overflow:auto;">
    <table id="log-table" class="table table-sm table-striped">
      <thead class="table-dark">
        <tr>
          <th>Time</th><th>IP</th><th>Method</th>
          <th>Path</th><th>Request JSON</th><th>Response JSON</th>
        </tr>
      </thead>
      <tbody>
        {# Show newest logs at the top #}
        {% for e in logs|reverse %}
        <tr>
          <td>{{ e.time }}</td>
          <td>{{ e.ip }}</td>
          <td>{{ e.method }}</td>
          <td>{{ e.path }}</td>
          <td>
            {% if e.req_json is not none %}
              <pre class="json-block">{{ e.req_json|tojson(indent=2) }}</pre>
            {% else %}
              <span class="text-muted">â€”</span>
            {% endif %}
          </td>
          <td>
            {% if e.res_json is not none %}
              <pre class="json-block">{{ e.res_json|tojson(indent=2) }}</pre>
            {% else %}
              <span class="text-muted">â€”</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<button id="scroll-top" class="btn btn-primary scroll-top">
  â†‘ Newest
</button>

<script id="init-data" type="application/json">
{{ logs | tojson }}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>



<script src="/static/js/admin.js"></script>
{% endblock %}
